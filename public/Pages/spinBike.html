<!DOCTYPE html>
<html>
  <link rel="stylesheet" href="/CSS/style.css" type="text/css">
  <link rel="stylesheet" href="/CSS/form.css" type="text/css">
  <meta charset="UTF-8">
  <script src="https://www.gstatic.com/firebasejs/7.13.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.13.0/firebase-firestore.memory.js"></script>
<!-- Don't change the format for any other products. -->
<script src="https://www.gstatic.com/firebasejs/7.13.0/firebase-auth.js"></script>
  </head>
  <meta name="google-signin-client_id" content="48180444980-7c2qdhtq2eonoc5di07i117cr68vg9d5.apps.googleusercontent.com">
  <script src="https://apis.google.com/js/platform.js" async defer></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <meta charset="utf-8"/>
  <title>Spin Bike</title>
  <link rel="shortcut icon" type="image/jpg" href="/img/curl.jpg"/>
  </head>


      <script type ="module" src="/script.js"></script>
      <meta charset="utf-8"/>
      <title>NFCurls</title>

      <script src="/scripts/onSignIn.js"></script>
    </head>


      <script type ="module" src="/script.js"></script>
      <meta charset="utf-8"/>
      <title>NFCurls</title>

      <script src="/scripts/onSignIn.js"></script>
    </head>
    <body>
        <script type="module" src="/scripts/readData.js"></script>
        <script type="module" src="/scripts/writeData.js"></script>
        <script src="/scripts/sideBar.js"></script>


        <style>
          .data{
            display:none ;
          }
        </style>
        <div id ="LoginScreen">
          <button id="login">Login with google</button>

        </div>

        <div id= "dashboard">
          <div id="userDetails"> </div>
          <button id="logout">logout</button>
        </div>


        <nav class ="myNav">
          <ul>
          <div id="main">
          <li><button class="openbtn" onclick="openNav()">&#9776; View Pages</button></li>
          </div>

            <li><div class="g-signin2" data-onsuccess="onSignIn"></div></li>
            <li><div class="data">
              <img id="pic" class="img-circle" width="100" height="100"/>
              <!---<a id ="fullName" href="" ></a>--->
              <!--This above could be used to display the user name is we want-->
              <button onclick="signOut()" class="btn btn-danger">Sign Out</button>

            </div></li>


          </ul>
        </nav>

        <div id="mySidebar" class="sidebar">
          <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
          <a href="#">About</a>
          <a href="#">Services</a>
          <a href="/Pages/Workouts.html">Workouts</a>
          <a href="#">Clients</a>
          <a href="#">Contact</a>
        </div>
<section>
    <div class="div-spinbike">
    <form id="spinbike" action="#" method="post">
      <fieldset>
        <legend>Spin Bike</legend>
        <label for="date" > Date:</label>
        <input type="date" id="spinbike-Date" autocomplete="on" required>
        <br>
        <br>
        <label for="totalRowingMachine" id="spinbike">Enter the Total Time spend on the Spin Bike (In Minutes): </label>
        <input type="number" id="spinbike-Total" required>
        <br>
      
    </fieldset>
  </form>
  <br>
  <button id="spinbike-submit">Submit Data</button>
</div>
</section>
<!--Google Authentication-->
<script>
  var firebaseConfig ={
  apiKey: "AIzaSyBYvjl_09gdM8dq1Uh__qjAERKDcPsyOAk",
  authDomain: "nfcurls.firebaseapp.com",
  databaseURL: "https://nfcurls-default-rtdb.firebaseio.com",
  projectId: "nfcurls",
  storageBucket: "nfcurls.appspot.com",
  messagingSenderId: "48180444980",
  appId: "1:48180444980:web:682281cf5debcb7811ef61",
  measurementId: "G-T2CF60NQPB"
};
  firebase.initializeApp(firebaseConfig);
  document.getElementById('dashboard').style.display="none"


  document.getElementById('login').addEventListener('click', GoogleLogin)
  document.getElementById('logout').addEventListener('click', LogoutUser)

  let provider = new firebase.auth.GoogleAuthProvider()

  function GoogleLogin(){
    console.log('Login Btn Call')
    firebase.auth().signInWithPopup(provider).then(res=>{
      console.log(res.user)
      document.getElementById('LoginScreen').style.display="none"
      document.getElementById('dashboard').style.display="block"
      showUserDetails(res.user)
    }).catch(e=>{
      console.log(e)
    })
  }
  function showUserDetails(user){


        document.getElementById('userDetails').innerHTML = `
          <img src="${user.photoURL}" style="width:10%">
          <p>Name: ${user.displayName}</p>
          <p>Email: ${user.email}</p>
          <p>UID: ${user.uid}</p>
        `
      }

      function checkAuthState(){
        firebase.auth().onAuthStateChanged(user=>{
          if(user){
            document.getElementById('LoginScreen').style.display="none"
            document.getElementById('dashboard').style.display="block"
            showUserDetails(user)
          }else{

          }
        })
      }

  function LogoutUser(){
    console.log('Logout Btn Call')
    firebase.auth().signOut().then(()=>{
      document.getElementById('LoginScreen').style.display="block"
      document.getElementById('dashboard').style.display="none"

    }).catch(e=>{

      console.log(e)
    })
  }
    checkAuthState()

    document.getElementById('spinbike-submit').addEventListener('click', addData)

    function addData(){

      let user = firebase.auth().currentUser;

      let uid = user.uid

      let date1 = document.getElementById('spinbike-Date').value

      const date = firebase.firestore.Timestamp.fromDate(new Date(date1)).toDate();

      

      
      let Totals = document.getElementById('spinbike-Total').value
      const Total = Number(Totals);
        
      let obj = {
        Date: date,
        User_ID: uid,
        Total_Time: Total,
        }

      firebase.firestore().collection('spinbike').add(obj).then(doc=>{
        console.log(doc.id)
      }).catch(e=>{
          console.log(e)
      })

      document.getElementById("spinbike").reset();
      alert("Data Submission Successful!")
    }
   </script>
</body>
</html>
